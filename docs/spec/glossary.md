# Glossary

This document defines the ubiquitous language used throughout the Emoji Whisper project. Consistent use of these terms across specifications, design documents and code prevents miscommunication.

## Core Domain Terms

| Term | Definition |
|------|------------|
| Suggestion | A single emoji generated by the AI that the user can accept or dismiss. Represented as a branded string type in the domain model. |
| SuggestionResult | A composite value object containing the emoji (`Suggestion`) and the model's reasoning (`reason: string`). Created by parsing the model's JSON output. |
| Reason | A short English sentence (under 15 words) output by the AI model explaining why it chose a particular emoji. Displayed in a tooltip on hover and logged for debugging. |
| Context | A text fragment extracted from the text **before the cursor position**, used to generate a suggestion. Extraction respects `maxContextLength` (default: 200 characters) and optionally adjusts to sentence boundaries. |
| Sentence Boundary | A character that marks the end of a sentence for context extraction purposes. Boundary characters are: `.`, `!`, `?`, `。`, `！`, `？`, and newline (`\n`). When `adjustToBoundary` is true, the context is trimmed to start after the first boundary character found within the extraction window. |
| Trigger | A condition that initiates suggestion generation. The default trigger is an idle pause after typing (and optionally pressing Enter), when the input is in a safe state (not composing, caret-only, sufficient length). |
| Overlay | A semi-transparent UI element rendered via an inline mirror div that covers the target input's content area. The mirror reproduces the input's text with the suggested emoji rendered inline at the caret, preventing the suggestion from covering existing text. See also: Mirror Overlay, Ghost Span. |
| Mirror Overlay | The transparent `<div>` (`.ec-mirror`) positioned exactly over the target input's content area. It copies all text-layout styles from the target and renders the full text with the ghost emoji inline at the caret position. The target's native text is hidden via `color: transparent`. |
| Ghost Span | The `<span>` (`.ec-mirror-ghost`) inside the mirror overlay that renders the suggested emoji at reduced opacity (0.5). Hovering over it reveals the reason tooltip. |
| MirrorContent | A domain value object (`src/core/domain/overlay/mirror-content.ts`) representing the decomposition of input text at the caret into three segments: `before`, `ghost` (emoji), and `after`. Produced by the pure function `splitTextAtCaret`. |
| Accept | The action of inserting the suggested emoji into the text. |
| Dismiss | The action of closing the suggestion without inserting it, typically via the Esc key. |
| Skip | Bypassing suggestion generation due to conditions (e.g., insufficient text length, empty input). |
| Cooldown | A minimum time window between suggestion attempts (e.g., 2 seconds) to avoid spamming. |
| Idle Delay | A short pause after the user's last input before a suggestion attempt is triggered (e.g., 500–800 ms). |
| Caret-only | A state where the selection is collapsed (selectionStart == selectionEnd), meaning the user is not selecting text. |

## Settings Terms

| Term | Definition |
|------|------------|
| minContextLength | Minimum number of **trimmed** characters required to trigger a suggestion. If the extracted context (after trimming whitespace) is shorter than this value, the suggestion is skipped. Default: 5. |
| maxContextLength | Maximum number of characters to extract **before the cursor**. If the text before the cursor exceeds this limit, only the last `maxContextLength` characters are used (then optionally adjusted to a sentence boundary). Default: 200. |
| adjustToBoundary | When true, context extraction adjusts to the nearest sentence boundary character within the extraction window. If a boundary is found, the context starts immediately after that boundary. If no boundary exists, the entire window is used. Default: true. |
| SkipConditions | A set of conditions that cause suggestion generation to be skipped: `skipIfEmpty` (trimmed input is empty), `skipIfEmojiOnly` (input contains only emoji/whitespace), `skipIfUrlOnly` (input matches `http://` or `https://` pattern). |
| PromptConfig | A value object describing the prompt configuration used to call the AI (system prompt template, output constraint, model options). |
| SystemPromptTemplate | The fixed system-level prompt used to constrain AI output in MVP. |
| PromptOptions | Model options such as `maxTokens`, `temperature`, and `topK` used for the Prompt API call. |
| topK | A model sampling parameter that controls how many top-probability tokens are considered at each generation step. Lower values (e.g. 3) restrict output diversity; higher values (e.g. 8–40) allow the model to select from a wider pool of candidates. Default: 8. |
| ContextMode | The extraction strategy: `'characters'` (legacy character-count based) or `'sentences'` (sentence-count based, see ADR 0007). |
| beforeSentenceCount | Number of complete sentences to extract **before** the cursor when using sentence mode. Default: 2. |
| afterSentenceCount | Number of complete sentences to extract **after** the cursor when using sentence mode. Default: 1. |
| cursorMarker | A marker string (default: `[CURSOR]`) inserted at the cursor position in the extracted context when using sentence mode. Tells the AI exactly where the emoji will be inserted. |

## State and Lifecycle Terms

| Term | Definition |
|------|------------|
| Idle | No suggestion session is active. |
| Pending | A suggestion has been requested from the AI and the response is awaited. |
| Shown | The overlay is visible and awaiting user action (accept or dismiss). |
| Completed | The suggestion session has ended via acceptance or dismissal. |

## Technical Terms

| Term | Definition |
|------|------------|
| Prompt API | The on-device AI API available in Chrome 138 and later, and in Microsoft Edge versions with equivalent availability. |
| LanguageModel | The global binding exposed by the Prompt API (Chrome 138+), available as `globalThis.LanguageModel`. It provides static `availability()` and `create()` methods; `create()` returns a session with `prompt()` (and optionally `destroy()`). |
| Content Script | An extension script injected into web pages to manipulate the DOM. |
| Service Worker | The asynchronous background execution context in Manifest V3, replacing background pages. |
